name: Build ESP32-C3 Games

on:
  push:
    paths:
      - "esp32-c3-games/**"
      - ".github/workflows/build-esp32-c3-games.yml"
  pull_request:
    paths:
      - "esp32-c3-games/**"
      - ".github/workflows/build-esp32-c3-games.yml"
  workflow_dispatch:

jobs:
  compile:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup arduino-cli
        uses: arduino/setup-arduino-cli@v2

      - name: Cache Arduino data
        uses: actions/cache@v4
        with:
          path: |
            ~/.arduino15
            ~/Arduino
          key: ${{ runner.os }}-arduino-${{ hashFiles('esp32-c3-games/**', '.github/workflows/build-esp32-c3-games.yml') }}
          restore-keys: |
            ${{ runner.os }}-arduino-

      - name: Configure board manager URLs
        run: arduino-cli config init --overwrite && arduino-cli config set board_manager.additional_urls https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json

      - name: Install ESP32 core
        run: arduino-cli core update-index && arduino-cli core install esp32:esp32

      - name: Install libraries
        run: arduino-cli lib install U8g2

      - name: Compile sketch
        run: arduino-cli compile --fqbn esp32:esp32:esp32c3 esp32-c3-games
